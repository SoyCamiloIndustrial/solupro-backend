<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Comprar Curso - $2.000 COP</title>
</head>
<body>

  <h1>Comprar Curso - $2.000 COP</h1>

  <button onclick="pagar()">Pagar con Wompi</button>

  <!-- Script del widget SIEMPRE antes de usarlo -->
  <script src="https://checkout.wompi.co/widget.js"></script>

  <script>
    async function pagar() {

      const PUBLIC_KEY = "pub_prod_i80UNdXv69FRkesjzaKNMyUHvNnDb5Mu";
      const BACKEND_URL = "https://solupro-backend-production.up.railway.app";

      const amountInCents = "200000"; // 2000 COP
      const currency = "COP";
      const reference = "order_" + Date.now();

      try {

        const response = await fetch(
          `${BACKEND_URL}/api/signature?reference=${reference}&amount=${amountInCents}&currency=${currency}`
        );

        const data = await response.json();

        const checkout = new WidgetCheckout({
          currency: currency,
          amountInCents: amountInCents,
          reference: reference,
          publicKey: PUBLIC_KEY,
          signature: {
            integrity: data.signature
          }
        });

        checkout.open(function(result) {
          console.log("Resultado:", result);
        });

      } catch (error) {
        console.error("Error:", error);
        alert("Error cargando pago");
      }
    }
  </script>

</body>
</html>
